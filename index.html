<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Socket.IO chat</title>
  <link rel="stylesheet" href="style/index.css">
  <!-- <style>
body,html{font:14px Helvetica, Arial;color:#333;margin:0;padding:0}.app{display:-webkit-box}.app .left-box,.app .min,.app .right-box{-webkit-box-flex:1;-webkit-box-pack:center;-webkit-box-align:center;-webkit-box-orient:vertical}.app .left-box,.app .right-box{width:200px;height:100vh;text-align:center}.app .left-box ul,.app .right-box ul{padding:0}.app .left-box h2,.app .right-box h2{padding:10px 0}.app .left-box li,.app .right-box li{list-style:none;padding-bottom:4px}.app .left-box{border-right:1px solid #8c8c8c}.app .right-box{border-left:1px solid #8c8c8c}.app .right-box .over-txt{color:#999}.min{width:80%;position:relative;padding:20px 0 70px 0}.min .name-list{text-align:center;max-height:100px;position:relative;overflow-y:auto}.min .name-list p{margin:5px 0}.min .name-list p.leave{color:#999}.min .name-list::before{content:"";width:100%;height:100px;position:absolute;left:0;top:0}.min .speech{float:left;min-width:20px;min-height:16px;margin:10px 0;padding:8px;table-layout:fixed;word-break:break-all;position:relative;border:1px solid #989898;border-radius:8px}.min .speech:before{content:'';position:absolute;width:0;height:0;left:15px;top:-20px;border:10px solid}.min .speech:after{content:'';position:absolute;width:0;height:0;left:17px;top:-16px;border:8px solid}.min .speech.right{display:inline-block;box-shadow:-2px 2px 5px #CCC;margin-right:10px;max-width:75%;float:right}.min .speech.right:before{content:'';position:absolute;width:0;height:0;top:9px;bottom:auto;left:auto;right:-10px;border-width:9px 0 9px 10px;border-color:transparent #989898}.min .speech.right:after{content:'';position:absolute;width:0;height:0;top:10px;bottom:auto;left:auto;right:-8px;border-width:8px 0 8px 9px;border-color:transparent #fff}.min .left{display:inline-block;box-shadow:2px 2px 2px #CCCCCC;margin-left:10px;max-width:75%;position:relative}.min .left:before{content:'';position:absolute;width:0;height:0;top:9px;bottom:auto;left:-10px;border-width:9px 10px 9px 0;border-color:transparent #989898}.min .left:after{content:'';position:absolute;width:0;height:0;top:10px;bottom:auto;left:-8px;border-width:8px 9px 8px 0;border-color:transparent #fff}.min .leftd{clear:both;float:left;margin-left:10px}.min .leftd .name{text-align:left;padding-left:10px}.min .rightd{clear:both;float:right;margin-right:10px}.min .rightd .name{text-align:right;padding-right:10px}.min .leftd_h{width:39px;height:39px;border-radius:100%;display:block;float:left;overflow:hidden}.min .rightd_h{width:39px;height:39px;border-radius:100%;display:block;float:right;overflow:hidden}form{background:#000;padding:3px;position:absolute;border-radius:10px;bottom:20px;width:90%;display:-webkit-box;margin:0 5%}form input,form button{display:-webkit-box;-webkit-box-flex:1;-webkit-box-pack:center;-webkit-box-align:center;-webkit-box-orient:vertical;border-radius:10px}form input{border:0;padding:10px;width:80%;margin-right:.5%;border-bottom-right-radius:0}form button{background:#82e0ff;color:#fff;border:none;padding:10px;border-top-left-radius:0}

  </style> -->
</head>

<body>
  <div class="app">
    <!-- left -->
    <div class="left-box">
      <h2>频道</h2>
      <ul class="name-list" id="nameList">
        <li>聊天室🍎</li>
        <li>聊天室🍌</li>
        <li>聊天室🥝</li>
      </ul>
    </div>
    <!-- min -->
    <section class="min">
      <div class="name-list" id="nameUser">
        <!-- <p>嘻嘻嘻 进入聊天室</p>
        <p class="leave">嘻嘻嘻 离开聊天室</p>
        <p>嘻嘻嘻 进入聊天室</p>
        <p>嘻嘻嘻 离开聊天室</p>
        <p>嘻嘻嘻 进入聊天室</p> -->
      </div>
      <div id="messages"></div>
      <!-- <div class="leftd">
        <div class="name">姓名姓名</div>
        <div class="speech left" ng-class="speech left">第三方的份上第三方的份上</div>
      </div>
      <div class="rightd">
        <div class="name">姓名姓名</div>
        <div class="speech right" ng-class="speech left">到事发地方s到事发地方s</div>
      </div>
      <div class="leftd">
        <div class="speech left" ng-class="speech left">水电费水电费水电费水电费水电费水电费水电费水电费</div>
      </div>
      <div class="rightd">
        <div class="speech right" ng-class="speech left">水电费水电费电风扇。。</div>
      </div>
      <div class="leftd">
        <div class="speech left" ng-class="speech left">东渡扶桑扶桑辅导费是发送到东渡扶桑辅导费是发送到东渡扶桑辅导费是发送到东渡扶桑辅导费是发送到东渡扶桑辅导费是发送到东渡扶桑辅导费是发送到东渡扶桑辅导费是发送到</div>
      </div> -->
      <form action="" id="mian">
        <input id="m" autocomplete="off" />
        <button>发送</button>
      </form>
    </section>
    <!-- rigt -->
    <div class="right-box">
      <h2>成员</h2>
      <ul class="name-list" id="nameListRigth">
        <!-- <li>成员11</li>
        <li>成员11</li>
        <li>成员11</li> -->
      </ul>
    </div>
  </div>
</body>
<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script>
  $(function () {
    var name = prompt("请输入你的姓名");
    // $('#nameUser').append($('<p>'+name+'  进入聊天室</p>'))
    var socket = io();
    // 内容输入
    socket.emit('chat name', name);
    $('#mian').submit(function () {
      socket.emit('chat message', {'txt':$('#m').val(),'name':name});
      $('#m').val('');
      return false;
    });
    // 当前窗口最小化
    document.addEventListener('visibilitychange', function() {
      var isHidden = document.hidden;
      if (isHidden) {
        socket.emit('over name', name);
      }else{
        window.location.reload()
      }
    });
    // 内容输出
    socket.on('chat name', function (msg) {
     $('#nameUser').append($('<p>'+msg+'  进入聊天室</p>'));
     $('#nameListRigth').append($('<li>'+msg+'</li>'));
    });
    socket.on('over name', function (msg) {
     $('#nameUser').append($('<p class="leave">'+msg+'  离开聊天室</p>'));
    });
    socket.on('chat message', function (msg) {
      console.log(msg)
      if(name == msg.name){
        $('#messages').append(
          '<div class="rightd">' +
          '   <div class="name">'+msg.name+'</div>' +
          '   <div class="speech right" ng-class="speech left">' + msg.txt + '</div>' +
          '</div>');
      }else{
        $('#messages').append(
          '<div class="leftd">' +
          '   <div class="name">'+msg.name+'</div>' +
          '   <div class="speech left" ng-class="speech left">' + msg.txt + '</div>' +
          '</div>');
      }
    });
  });
</script>
</html>